@using Dragonfly.Migration7To8Helpers
@using Dragonfly.NetModels
@using Newtonsoft.Json

@inherits UmbracoViewPage<IEnumerable<Dragonfly.Umbraco8SiteTester.Models.FileInfo>>

@{
    var pvException = Config.GetViewsPath() + "Partials/ExceptionDetailsLink.cshtml";
}

@if (Model.Any())
{
    <ol>
        @foreach (var parsedFile in Model.OrderByDescending(n => n.Timestamp))
        {

            var url = string.Format("/Umbraco/backoffice/Api/SiteTesterApi/ViewResults?FileName={0}", parsedFile.Filename);
            var logDate = ViewHelpers.FormatUtcDateTime(parsedFile.Timestamp.ToUniversalTime());
            //var parsedFile = FilesIO.ParseFilePath(file.Key);
            var startNode =parsedFile.StartNode;
            var nodeInfo = startNode == 0 ? "All Nodes" : string.Format("'{0}' & descendants", Umbraco.Content(startNode).Name);
            <li>
                <a href="@url" target="_blank">@logDate : @nodeInfo</a>
            </li>
        }
    </ol>
}
else
{
    <i style="color:red;">There are no test sets available currently.</i>
}